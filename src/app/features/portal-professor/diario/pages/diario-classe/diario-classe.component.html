<div class="p-4 sm:p-6 font-sans bg-gray-100 min-h-screen">

  <!-- Cabeçalho da Página -->
  <div class="mb-6">
    <p-button
      label="Voltar ao Painel"
      icon="pi pi-arrow-left"
      severity="secondary"
      size="small"
      (onClick)="voltarAoPainel()"
      styleClass="mb-4">
    </p-button>

    <h1 class="text-2xl font-bold text-gray-800">
      Diário de Classe:
      <span class="text-blue-700">{{ turmaAtual()?.nomeTurma || 'Carregando...' }}</span>
    </h1>
    <p class="text-sm text-gray-500">{{ turmaAtual()?.disciplina }} - {{ turmaAtual()?.periodo }}</p>
  </div>

  <!-- Estatísticas Rápidas -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" *ngIf="estatisticas()">
    <p-card styleClass="text-center">
      <div class="text-2xl font-bold text-blue-600">{{ estatisticas().total }}</div>
      <div class="text-sm text-gray-600">Total Alunos</div>
    </p-card>

    <p-card styleClass="text-center">
      <div class="text-2xl font-bold text-green-600">{{ estatisticas().presentes }}</div>
      <div class="text-sm text-gray-600">Presentes</div>
    </p-card>

    <p-card styleClass="text-center">
      <div class="text-2xl font-bold text-red-600">{{ estatisticas().ausentes }}</div>
      <div class="text-sm text-gray-600">Ausentes</div>
    </p-card>

    <p-card styleClass="text-center">
      <div class="text-2xl font-bold text-purple-600">{{ estatisticas().percentualAprovacao }}%</div>
      <div class="text-sm text-gray-600">Aprovação</div>
    </p-card>
  </div>

  <!-- Card Principal com Abas -->
  <p-card styleClass="shadow-md">
    <p-tabView [activeIndex]="abaAtiva() === 'frequencia' ? 0 : 1" (activeIndexChange)="onTabChange($event)">

      <!-- Aba Frequência -->
      <p-tabPanel header="Frequência" leftIcon="pi pi-check">
        <div class="overflow-x-auto">
          <p-table [value]="alunosDaTurma()" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>Aluno</th>
                <th>Matrícula</th>
                <th class="text-center">Presença (Hoje)</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-aluno>
              <tr>
                <td class="font-medium">{{ aluno.nome }}</td>
                <td class="text-gray-600">{{ aluno.matricula }}</td>
                <td class="text-center">
                  <div class="flex justify-center gap-1">
                    <p-button
                      label="P"
                      size="small"
                      [severity]="isPresencaSelecionada(aluno, 'P') ? 'success' : 'secondary'"
                      [outlined]="!isPresencaSelecionada(aluno, 'P')"
                      (onClick)="atualizarPresenca(aluno.id, 'P')">
                    </p-button>
                    <p-button
                      label="F"
                      size="small"
                      [severity]="isPresencaSelecionada(aluno, 'F') ? 'danger' : 'secondary'"
                      [outlined]="!isPresencaSelecionada(aluno, 'F')"
                      (onClick)="atualizarPresenca(aluno.id, 'F')">
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>

      <!-- Aba Notas -->
      <p-tabPanel header="Notas" leftIcon="pi pi-chart-line">
        <div class="overflow-x-auto">
          <p-table [value]="alunosDaTurma()" styleClass="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr>
                <th>Aluno</th>
                <th class="text-center w-24">B1</th>
                <th class="text-center w-24">B2</th>
                <th class="text-center w-24">B3</th>
                <th class="text-center w-24">B4</th>
                <th class="text-center w-28">Média Final</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-aluno>
              <tr>
                <td class="font-medium">{{ aluno.nome }}</td>
                <td class="text-center">
                  <p-inputNumber
                    [ngModel]="aluno.notas.b1"
                    (onInput)="atualizarNota(aluno.id, 'b1', $event)"
                    mode="decimal"
                    [min]="0"
                    [max]="10"
                    [maxFractionDigits]="1"
                    size="small"
                    styleClass="w-full text-center">
                  </p-inputNumber>
                </td>
                <td class="text-center">
                  <p-inputNumber
                    [ngModel]="aluno.notas.b2"
                    (onInput)="atualizarNota(aluno.id, 'b2', $event)"
                    mode="decimal"
                    [min]="0"
                    [max]="10"
                    [maxFractionDigits]="1"
                    size="small"
                    styleClass="w-full text-center">
                  </p-inputNumber>
                </td>
                <td class="text-center">
                  <p-inputNumber
                    [ngModel]="aluno.notas.b3"
                    (onInput)="atualizarNota(aluno.id, 'b3', $event)"
                    mode="decimal"
                    [min]="0"
                    [max]="10"
                    [maxFractionDigits]="1"
                    size="small"
                    styleClass="w-full text-center">
                  </p-inputNumber>
                </td>
                <td class="text-center">
                  <p-inputNumber
                    [ngModel]="aluno.notas.b4"
                    (onInput)="atualizarNota(aluno.id, 'b4', $event)"
                    mode="decimal"
                    [min]="0"
                    [max]="10"
                    [maxFractionDigits]="1"
                    size="small"
                    styleClass="w-full text-center">
                  </p-inputNumber>
                </td>
                <td class="text-center font-bold" [ngClass]="getCorMedia(aluno.mediaFinal)">
                  {{ aluno.mediaFinal?.toFixed(1) ?? '---' }}
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>
    </p-tabView>

    <!-- Botões de Ação -->
    <div class="flex justify-end gap-2 mt-6 pt-4 border-t border-gray-200">
      <p-button
        label="Cancelar"
        severity="secondary"
        icon="pi pi-times"
        (onClick)="voltarAoPainel()">
      </p-button>
      <p-button
        label="Salvar Alterações"
        icon="pi pi-save"
        (onClick)="salvarDados()">
      </p-button>
    </div>

  </p-card>
</div>